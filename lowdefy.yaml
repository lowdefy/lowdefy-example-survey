name: lowdefy-example-survey
version: '3.1.1'
connections:
  - id: example_sheet
    type: GoogleSheet
    properties:
      client_email:
        _secret: SHEETS_CLIENT_EMAIL
      private_key:
        _secret: SHEETS_PRIVATE_KEY
      sheetIndex: 0
      spreadsheetId: 1wldNzkdP7-qSBz8pdtYrx8dlTw01vqQ9gn6KfXPg5DU
      write: true
pages:
  - id: survey
    type: Context
    layout:
      contentAlign: center
    blocks:
      - id: header_bar
        type: Html
        properties:
          html: |
            <div style="height: 1em; background: #000;"></div> 
      - id: logo
        type: Html
        properties:
          html: |
            <div style="background: #fff; text-align: center; padding: 10px"><img src="https://lowdefy-public.s3-eu-west-1.amazonaws.com/dunder_logo.jpg" height="80px"/></div>
      - id: header_bar
        type: Html
        properties:
          html: |
            <div style="height: 1em; background: #000;"></div> 
      - id: content_box
        type: Box
        style:  
          maxWidth: 600
          padding: 30px 0
          minHeight: 80vh
        layout:
          contentGutter: 20
        blocks:
          - id: title
            type: Title
            style:
              textAlign: center
              paddingTop: 20
            properties:
              content: How was your paper experience?
              level: 1
          - id: intro
            type: Title
            style:
              textAlign: center
              paddingTop: 20
            properties:
              content: Your input is highly valued. Your feedback will be used to improve our service to you.
              level: 4
          - id: name
            type: TextInput
            required: true
            properties:
              title: Name & Surname
              size: large
          - id: company
            type: TextInput
            required: true
            properties:
              title: Company Name
              size: large
          - id: type
            type: ButtonSelector
            required: true
            properties:
              title: Type
              size: large
              options:
                - Feedback
                - Query
                - Complaint
          - id: sales_person
            type: Selector
            required: true
            visible:
              _and:
                - _not:
                    _eq: 
                      - _state: type
                      - Feedback
                - _state: type
            properties:
              title: Sales Person
              size: large
              options:
                - Jim Halpert
                - Dwight K. Schrute
                - Phyllis Vance
                - Stanley Hudson
                - Andy Bernard
                - Todd Packer
          
          - id: response
            type: TextArea
            required: true
            visible:
              _not:
                _not:
                  _state: type
            properties:
              title: Please tell us more
              size: large
          - id: satisfaction_title
            type: Title
            visible:
              _not:
                _not:
                  _state: response
            style:
              textAlign: center
              paddingTop: 20
            properties:
              content: One last thing, based on your experience with us, how likely are you to recommend Dunder Mufflin Paper Company? 
              level: 4
          - id: satisfaction
            type: RatingSlider
            visible:
              _not:
                _not:
                  _state: response
            properties:
              label:
                disabled: true
            actions:
              onChange:
                - id: set_flag
                  type: SetState
                  params:
                    satisfaction_changed: true
          - id: detractor_response_title
            type: Title
            visible:
              _get:
                key: v
                from: 
                  _mql_expr:
                    v: 
                      $and:
                        - $lte:
                          - _state: satisfaction
                          - 7
                        - _state: satisfaction_changed
            style:
              textAlign: center
              paddingTop: 20
            properties:
              content: Oh no! We can do better!
              level: 4
          - id: detractor_response
            type: TextArea
            required: true
            visible:
              _get:
                key: v
                from: 
                  _mql_expr:
                    v: 
                      $and:
                        - $lte:
                          - _state: satisfaction
                          - 7
                        - _state: satisfaction_changed
            properties:
              title: Please could your provide us with some further detail on your hesitancy to recommend us so we know what to work on.
              placeholder: What could we have done better?
              size: large
          - id: promoter_response_title
            type: Title
            visible:
              _get:
                key: v
                from: 
                  _mql_expr:
                    v: 
                      $and:
                        - $gt:
                          - _state: satisfaction
                          - 7
                        - _state: satisfaction_changed
            style:
              textAlign: center
              paddingTop: 20
            properties:
              content: Your smile makes us smile!
              level: 4
          - id: promoter_response
            type: TextArea
            required: true
            visible:
              _get:
                key: v
                from: 
                  _mql_expr:
                    v: 
                      $and:
                        - $gt:
                          - _state: satisfaction
                          - 7
                        - _state: satisfaction_changed
            properties:
              title: Good news should be shared! Please can you let us know what made you smile so we can keep up the good work.
              placeholder: What did you like?
              size: large
              label: 
                colon: false
          - id: save
            type: Button
            requests:
              - id: save
                type: GoogleSheetAppendOne
                connectionId: example_sheet
                properties:
                  row:
                    name:
                      _state: name
                    company:
                      _state: company
                    type:
                      _state: type
                    sales_person:
                      _state: sales_person
                    response:
                      _state: response
                    satisfaction:
                      _state: satisfaction
                    detractor_response:
                      _state: detractor_response
                    promoter_response:
                      _state: promoter_response
                    timestamp:
                      _state: timestamp
                    id:
                      _url_query: id
            actions:
              onClick:
                - id: set_state
                  type: SetState
                  params:
                    timestamp:
                      _date: now
                - id: validate
                  type: Validate
                - id: call_save
                  type: Request
                  params: save
                - id: to_thank_you_page
                  type: Link
                  params:
                    pageId: thank-you
            visible:
              _not:
                _not:
                  _state: satisfaction_changed
            properties:
              title: Submit
              block: true
              color: '#000'
              icon: CheckOutlined
              size: large
          - id: header_bar
            type: Html
            visible:
              _not:
                _not:
                  _state: satisfaction_changed
            style:
              fontSize: 10
              textAlign: center
            properties:
              html: For this example, the submitted data will be public.
      - id: bar_footer
        type: Html
        properties:
          html: |
            <div style="height: 1em; background: #000;"></div> 
      - id: logo_footer
        type: Html
        properties:
          html: |
            <div style="background: #fff; text-align: center; padding: 10px"><a href="https://www.lowdefy.com" style="color: #000; font-size: 1em;">This is a Lowdefy example app ðŸ¦–</a></div>
  - id: thank-you
    type: Context
    layout:
      contentAlign: center
    blocks:
      - id: header_bar
        type: Html
        properties:
          html: |
            <div style="height: 1em; background: #000;"></div> 
      - id: logo
        type: Html
        properties:
          html: |
            <div style="background: #fff; text-align: center; padding: 10px"><img src="https://lowdefy-public.s3-eu-west-1.amazonaws.com/dunder_logo.jpg" height="80px"/></div>
      - id: header_bar
        type: Html
        properties:
          html: |
            <div style="height: 1em; background: #000;"></div> 
      - id: content_box
        type: Box
        style:  
          maxWidth: 600
          padding: 30px 0
          minHeight: 80vh
        layout:
          contentGutter: 20
        blocks:
          - id: title
            type: Title
            style:
              textAlign: center
              paddingTop: 20
            properties:
              content: Thank you for you feedback!
              level: 1
          - id: thank_you
            type: Html
            style:
              maxWidth: 400
              margin: auto
              textAlign: center
            properties:
              html: |
                This webform saved the data to <a href="https://docs.google.com/spreadsheets/d/1wldNzkdP7-qSBz8pdtYrx8dlTw01vqQ9gn6KfXPg5DU/edit?usp=sharing">this Google Sheet</a>
                <br/>
                This Lowdefy example is less than 500 lines of YAML. 
                <br/>
                <a href="https://github.com/lowdefy/lowdefy-example-survey">Visit the repo to for the Lowdefy config.</a>
                <br/>
                <br/>
                <img src="https://lowdefy-public.s3-eu-west-1.amazonaws.com/dunder_thank_you.gif" width="100%"/>
      - id: bar_footer
        type: Html
        properties:
          html: |
            <div style="height: 1em; background: #000;"></div> 
      - id: logo_footer
        type: Html
        properties:
          html: |
            <div style="background: #fff; text-align: center; padding: 10px"><a href="https://www.lowdefy.com" style="color: #000; font-size: 1em;">This is a Lowdefy example app ðŸ¦–</a></div>